<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collection Pro - FW Tools</title>
    <meta name="description" content="Web app tƒÉng hi·ªáu su·∫•t data collection cho kh·∫£o s√°t quantitative online">
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/icons/logo.png" alt="FW Tools" class="logo-icon-img">
                    <span class="logo-text">FW Tools</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#import" class="nav-item" data-view="import">
                    <span class="nav-icon">üì•</span>
                    <span class="nav-text">Import Data</span>
                </a>
                <a href="#urlImport" class="nav-item" data-view="urlImport">
                    <span class="nav-icon">üåê</span>
                    <span class="nav-text">URL Import</span>
                </a>
                <a href="#projects" class="nav-item" data-view="projects">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Projects</span>
                </a>
                <a href="#data" class="nav-item" data-view="data">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Filter & Batch</span>
                </a>
                <a href="#export" class="nav-item" data-view="export">
                    <span class="nav-icon">üì§</span>
                    <span class="nav-text">Export</span>
                </a>
                <a href="#config" class="nav-item" data-view="config">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Config</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                    <span class="theme-icon">üåô</span>
                </button>
                <span class="version">v1.0.0</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="project-manager">
                        <select id="projectSelect" class="form-control form-control-sm"
                            onchange="handleProjectSelect(this.value); updateProjectStarButton();">
                            <option value="">-- Ch·ªçn Project --</option>
                        </select>
                        <button class="star-toggle" id="projectStarBtn" style="display: none;"
                            onclick="toggleStarProject(document.getElementById('projectSelect').selectedOptions[0]?.text)"
                            title="G·∫Øn sao d·ª± √°n">‚òÜ</button>
                        <button class="btn btn-sm btn-primary" onclick="saveCurrentProject()" title="Save Project">üíæ
                            Save</button>
                        <button class="btn btn-sm btn-secondary" onclick="createNewProject()" title="New Project">+
                            New</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCurrentProject()" title="Delete Project"
                            id="deleteProjectBtn" style="display: none;">üóëÔ∏è</button>
                        <span class="save-indicator" id="saveIndicator">‚úì Saved</span>
                    </div>
                    <div class="notification-bell" id="notificationBell">
                        <button class="btn btn-icon notification-btn" onclick="toggleNotificationPanel()"
                            title="Notifications">
                            <img src="assets/icons/bell.png" alt="Notifications" class="bell-icon">
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <div class="notification-panel" id="notificationPanel" style="display: none;">
                            <div class="notification-header">
                                <span>Th√¥ng b√°o</span>
                                <button class="btn btn-xs btn-outline" onclick="clearNotifications()">Clear</button>
                            </div>
                            <div class="notification-list" id="notificationList">
                                <div class="notification-empty">Kh√¥ng c√≥ th√¥ng b√°o m·ªõi</div>
                            </div>
                        </div>
                    </div>
                    <div class="file-info" id="fileInfo">
                        <span class="file-name">No file loaded</span>
                    </div>
                </div>
            </header>

            <!-- Content Views -->
            <div class="content-wrapper">
                <!-- Dashboard View -->
                <section class="view active" id="dashboardView">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon total">üìä</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalRows">0</span>
                                <span class="stat-label">Total Rows</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon sms">üì±</div>
                            <div class="stat-info">
                                <span class="stat-value" id="smsMarked">0</span>
                                <span class="stat-label">SMS Marked</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon email">üìß</div>
                            <div class="stat-info">
                                <span class="stat-value" id="emailMarked">0</span>
                                <span class="stat-label">Email Marked</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon pending">‚è≥</div>
                            <div class="stat-info">
                                <span class="stat-value" id="pendingRows">0</span>
                                <span class="stat-label">Pending</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-content">
                        <div class="card batch-history-card">
                            <div class="card-header">
                                <h3>üìà Batch History</h3>
                            </div>
                            <div class="card-body">
                                <div class="batch-chart" id="batchChart">
                                    <div class="empty-state">
                                        <span class="empty-icon">üìä</span>
                                        <p>Import data ƒë·ªÉ xem th·ªëng k√™ batch</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card recent-actions-card">
                            <div class="card-header">
                                <h3>üìã Recent Actions</h3>
                            </div>
                            <div class="card-body">
                                <ul class="action-list" id="actionList">
                                    <li class="empty-state">
                                        <span class="empty-icon">üìù</span>
                                        <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <h3>‚ö° Quick Actions</h3>
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="switchView('import')">
                                <span class="qa-icon">üì•</span>
                                <span>Import File</span>
                            </button>
                            <button class="quick-action-btn" onclick="markBatch('sms', 500)" id="quickMarkSms" disabled>
                                <span class="qa-icon">üì±</span>
                                <span>Mark SMS 500</span>
                            </button>
                            <button class="quick-action-btn" onclick="markBatch('email', 500)" id="quickMarkEmail"
                                disabled>
                                <span class="qa-icon">üìß</span>
                                <span>Mark Email 500</span>
                            </button>
                            <button class="quick-action-btn" onclick="exportLatestBatch()" id="quickExport" disabled>
                                <span class="qa-icon">üì§</span>
                                <span>Export Latest</span>
                            </button>
                        </div>
                    </div>

                    <!-- Starred Projects Card -->
                    <div class="card starred-projects-card">
                        <div class="card-header">
                            <h3><img src="assets/icons/star.png" alt="" class="header-icon"> D·ª± √°n y√™u th√≠ch</h3>
                            <img src="assets/icons/drink.png" alt="Relax" class="relax-icon" title="Have a break!">
                        </div>
                        <div class="card-body">
                            <div class="starred-projects-list" id="starredProjectsList">
                                <p class="no-starred">Ch∆∞a c√≥ d·ª± √°n n√†o ƒë∆∞·ª£c g·∫Øn sao. Click ‚≠ê b√™n c·∫°nh t√™n d·ª± √°n ƒë·ªÉ
                                    th√™m.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Import View -->
                <section class="view" id="importView">
                    <div class="import-container">
                        <!-- Import Type Tabs -->
                        <div class="import-type-tabs">
                            <button class="tab-btn active" data-import-type="file" onclick="switchImportTab('file')">üìÅ
                                Import File</button>
                            <button class="tab-btn" data-import-type="url" onclick="switchImportTab('url')">üåê Import
                                URL</button>
                            <button class="tab-btn" data-import-type="api" onclick="switchImportTab('api')">üîó Alchemer
                                API</button>
                        </div>

                        <!-- File Import Panel -->
                        <div class="import-panel" id="fileImportPanel">
                            <div class="drop-zone" id="dropZone">
                                <div class="drop-zone-content">
                                    <span class="drop-icon">üìÅ</span>
                                    <h3>K√©o th·∫£ file v√†o ƒë√¢y</h3>
                                    <p>H·ªó tr·ª£ CSV, Excel (.xlsx, .xls)</p>
                                    <div class="drop-divider">
                                        <span>ho·∫∑c</span>
                                    </div>
                                    <div class="file-input-wrapper">
                                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" hidden>
                                        <button class="btn btn-primary"
                                            onclick="document.getElementById('fileInput').click()">Ch·ªçn File</button>
                                    </div>
                                </div>
                            </div>

                            <div class="import-options card" id="importOptions" style="display: none;">
                                <div class="card-header">
                                    <h3>‚öôÔ∏è Import Options</h3>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label>Sheet (cho file Excel):</label>
                                        <select id="sheetSelect" class="form-control">
                                            <option value="0">Sheet 1</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Header row:</label>
                                        <input type="number" id="headerRow" class="form-control" value="1" min="1">
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <label>
                                            <input type="checkbox" id="autoDetectColumns" checked>
                                            T·ª± ƒë·ªông detect column mapping
                                        </label>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-secondary" onclick="cancelImport()">H·ªßy</button>
                                    <button class="btn btn-primary" onclick="confirmImport()">Import</button>
                                </div>
                            </div>

                            <div class="import-preview card" id="importPreview" style="display: none;">
                                <div class="card-header">
                                    <h3>üëÅÔ∏è Preview</h3>
                                    <span class="preview-count" id="previewCount"></span>
                                </div>
                                <div class="card-body">
                                    <div class="table-container">
                                        <table class="data-table" id="previewTable">
                                            <thead></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- URL Import Panel -->
                        <div class="import-panel" id="urlImportPanel" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <h3>üåê Import t·ª´ URL</h3>
                                </div>
                                <div class="card-body">
                                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                        Nh·∫≠p URL c·ªßa file CSV ho·∫∑c Excel ƒë·ªÉ import tr·ª±c ti·∫øp.
                                    </p>
                                    <div class="form-group">
                                        <label>URL:</label>
                                        <input type="url" id="importUrl" class="form-control"
                                            placeholder="https://example.com/data.csv">
                                    </div>
                                    <div class="url-import-progress" id="urlImportProgress" style="display: none;">
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="urlProgressFill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text" id="urlProgressText">ƒêang t·∫£i...</span>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="importFromUrl()">
                                        üì• Import t·ª´ URL
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Alchemer API Panel -->
                        <div class="import-panel" id="apiImportPanel" style="display: none;">
                            <!-- API Credentials Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>üîë API Credentials</h3>
                                    <span class="api-status" id="apiStatus">Not configured</span>
                                </div>
                                <div class="card-body">
                                    <div class="config-grid">
                                        <div class="form-group">
                                            <label>API Token:</label>
                                            <input type="text" id="apiToken" class="form-control"
                                                placeholder="Your Alchemer API Token">
                                        </div>
                                        <div class="form-group">
                                            <label>API Secret:</label>
                                            <input type="password" id="apiSecret" class="form-control"
                                                placeholder="Your API Secret">
                                        </div>
                                        <div class="form-group">
                                            <label>Survey ID:</label>
                                            <input type="text" id="apiSurveyId" class="form-control"
                                                placeholder="Survey ID to fetch">
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-secondary" onclick="testApiConnection()">üîç Test
                                        Connection</button>
                                    <button class="btn btn-primary" onclick="saveApiCredentials()">üíæ Save
                                        Credentials</button>
                                </div>
                            </div>

                            <!-- Update Status Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>üîÑ Update Response Status</h3>
                                </div>
                                <div class="card-body">
                                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                        L·∫•y status (Complete/Partial/Disqualified) t·ª´ Alchemer v√† c·∫≠p nh·∫≠t v√†o data ƒë√£
                                        import.
                                    </p>
                                    <div class="config-grid">
                                        <div class="form-group">
                                            <label>PLID Column (trong data hi·ªán t·∫°i):</label>
                                            <select id="plidColumnSelect" class="form-control">
                                                <option value="">-- Ch·ªçn c·ªôt ch·ª©a PLID --</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Status Column (s·∫Ω t·∫°o m·ªõi n·∫øu ch∆∞a c√≥):</label>
                                            <input type="text" id="statusColumnName" class="form-control"
                                                value="Response_Status" placeholder="Response_Status">
                                        </div>
                                    </div>
                                    <div class="api-progress" id="apiProgress" style="display: none;">
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="apiProgressFill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text" id="apiProgressText">0%</span>
                                    </div>
                                    <div class="api-result" id="apiResult" style="display: none; margin-top: 16px;">
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="fetchAndUpdateStatus()"
                                        id="fetchStatusBtn">
                                        üîÑ Fetch & Update Status
                                    </button>
                                </div>
                            </div>

                            <!-- Fetch Full Data Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>üì• Fetch Full Survey Data</h3>
                                </div>
                                <div class="card-body">
                                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                        T·∫£i to√†n b·ªô responses t·ª´ survey v√† thay th·∫ø data hi·ªán t·∫°i.
                                    </p>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-secondary" onclick="fetchFullSurveyData()">
                                        üì• Fetch All Responses
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- URL Import View -->
                <section class="view" id="urlImportView">
                    <div class="url-import-container">
                        <!-- Import Form Card -->
                        <div class="card url-import-card">
                            <div class="card-header">
                                <h3>üåê Import t·ª´ URL</h3>
                            </div>
                            <div class="card-body">
                                <div class="url-import-form">
                                    <div class="form-row">
                                        <div class="form-group flex-2">
                                            <label>URL file CSV/Excel:</label>
                                            <input type="url" id="urlModuleInput" class="form-control"
                                                placeholder="https://example.com/data.csv">
                                        </div>
                                        <div class="form-group flex-1">
                                            <label>T√™n d·ª± √°n:</label>
                                            <input type="text" id="urlProjectName" class="form-control"
                                                placeholder="T√™n d·ª± √°n...">
                                        </div>
                                        <div class="form-group flex-0">
                                            <label>&nbsp;</label>
                                            <button class="btn btn-primary" onclick="importUrlModule()">
                                                üì• Import
                                            </button>
                                        </div>
                                    </div>
                                    <div class="url-import-progress" id="urlModuleProgress" style="display: none;">
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="urlModuleProgressFill" style="width: 0%">
                                            </div>
                                        </div>
                                        <span class="progress-text" id="urlModuleProgressText">ƒêang t·∫£i...</span>
                                    </div>
                                </div>
                                <div class="url-history-section">
                                    <div class="url-history-header">
                                        <label>üìú L·ªãch s·ª≠ import:</label>
                                        <div class="url-history-actions">
                                            <button class="btn btn-xs btn-outline" onclick="toggleUrlHistoryPanel()">
                                                <span id="urlHistoryToggleIcon">‚ñº</span>
                                            </button>
                                            <button class="btn btn-xs btn-outline" onclick="clearAllUrlHistory()"
                                                title="X√≥a t·∫•t c·∫£">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    <div class="url-history-list" id="urlHistoryList" style="display: none;">
                                        <!-- History items will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- URL Data Table -->
                        <div class="card url-data-card" id="urlDataCard" style="display: none;">
                            <div class="card-header">
                                <h3 id="urlDataTitle">üìä D·ªØ li·ªáu</h3>
                                <div class="url-toolbar">
                                    <!-- Filter -->
                                    <div class="url-filter-group">
                                        <select id="urlFilterColumn" class="form-control form-control-sm"
                                            onchange="updateUrlFilterValues()">
                                            <option value="">-- L·ªçc theo c·ªôt --</option>
                                        </select>
                                        <div class="url-filter-dropdown">
                                            <button class="btn btn-sm btn-outline" id="urlFilterValBtn"
                                                onclick="toggleUrlFilterPanel()">
                                                Ch·ªçn gi√° tr·ªã ‚ñº
                                            </button>
                                            <div class="url-filter-panel" id="urlFilterPanel" style="display: none;">
                                                <div class="panel-header">
                                                    <span>L·ªçc theo gi√° tr·ªã</span>
                                                    <button class="btn btn-xs btn-outline"
                                                        onclick="toggleUrlFilterAll(true)">All</button>
                                                    <button class="btn btn-xs btn-outline"
                                                        onclick="toggleUrlFilterAll(false)">None</button>
                                                </div>
                                                <div class="filter-values-list" id="urlFilterValuesList"></div>
                                                <div class="panel-footer">
                                                    <button class="btn btn-sm btn-primary"
                                                        onclick="applyUrlMultiFilter()">√Åp d·ª•ng</button>
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn btn-xs btn-outline" onclick="clearUrlFilter()">‚úï</button>
                                    </div>
                                    <!-- Column Visibility -->
                                    <div class="url-visibility-dropdown">
                                        <button class="btn btn-sm btn-outline" id="urlColVisBtn"
                                            onclick="toggleUrlColumnPanel()">
                                            üëÅÔ∏è C·ªôt
                                        </button>
                                        <div class="url-visibility-panel" id="urlColVisPanel" style="display: none;">
                                            <div class="panel-header">
                                                <span>Hi·ªÉn th·ªã c·ªôt</span>
                                                <button class="btn btn-xs btn-outline"
                                                    onclick="toggleUrlAllColumns(true)">All</button>
                                                <button class="btn btn-xs btn-outline"
                                                    onclick="toggleUrlAllColumns(false)">None</button>
                                            </div>
                                            <div class="column-list" id="urlColumnList"></div>
                                        </div>
                                    </div>
                                    <span class="url-data-info" id="urlDataInfo"></span>
                                </div>
                            </div>
                            <div class="card-body url-table-body">
                                <div class="data-table-container url-table-compact">
                                    <table class="data-table url-table" id="urlDataTable">
                                        <thead id="urlDataTableHead"></thead>
                                        <tbody id="urlDataTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="url-pagination-controls">
                                    <div class="pagination-left">
                                        <div class="pagination-buttons">
                                            <button class="btn btn-sm btn-outline"
                                                onclick="goToUrlPage('first')">‚èÆÔ∏è</button>
                                            <button class="btn btn-sm btn-outline"
                                                onclick="goToUrlPage('prev')">‚óÄÔ∏è</button>
                                            <span class="page-numbers" id="urlPageNumbers"></span>
                                            <button class="btn btn-sm btn-outline"
                                                onclick="goToUrlPage('next')">‚ñ∂Ô∏è</button>
                                            <button class="btn btn-sm btn-outline"
                                                onclick="goToUrlPage('last')">‚è≠Ô∏è</button>
                                        </div>
                                        <span class="pagination-info" id="urlPaginationInfo">Page 1 of 1</span>
                                    </div>
                                    <div class="pagination-right">
                                        <span>Rows:</span>
                                        <select id="urlRowsPerPage" class="form-control form-control-sm"
                                            onchange="changeUrlRowsPerPage(this.value)">
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100" selected>100</option>
                                            <option value="200">200</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Projects View -->
                <section class="view" id="projectsView">
                    <div class="projects-container">
                        <div class="projects-header">
                            <h2>üìä Project Management</h2>
                            <button class="btn btn-primary" onclick="openProjectModal()">
                                ‚ûï New Project
                            </button>
                        </div>

                        <div class="projects-layout">
                            <!-- Project List -->
                            <div class="projects-list-panel">
                                <div class="card">
                                    <div class="card-header">
                                        <h3>üìÅ Projects</h3>
                                        <span class="badge" id="projectCount">0</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="projects-list" id="projectsList">
                                            <div class="empty-state">
                                                <span class="empty-icon">üìÇ</span>
                                                <p>Ch∆∞a c√≥ project n√†o</p>
                                                <button class="btn btn-outline" onclick="openProjectModal()">
                                                    T·∫°o project ƒë·∫ßu ti√™n
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Project Detail -->
                            <div class="project-detail-panel">
                                <div class="card" id="projectDetailCard" style="display: none;">
                                    <div class="card-header">
                                        <h3 id="projectDetailTitle">Project Detail</h3>
                                        <div class="project-actions">
                                            <button class="btn btn-xs btn-outline" onclick="editCurrentProject()"
                                                title="Edit">‚úèÔ∏è</button>
                                            <button class="btn btn-xs btn-outline btn-danger"
                                                onclick="deleteCurrentProjectMgmt()" title="Delete">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- Project Info -->
                                        <div class="project-info-section">
                                            <div class="info-row">
                                                <span class="info-label">Survey ID:</span>
                                                <span class="info-value" id="projectSurveyId">-</span>
                                            </div>
                                            <div class="info-row">
                                                <span class="info-label">Target:</span>
                                                <span class="info-value" id="projectTarget">-</span>
                                            </div>
                                        </div>

                                        <!-- Criteria Section -->
                                        <div class="project-criteria-section">
                                            <h4>üìã Ti√™u ch√≠ d·ª± √°n</h4>
                                            <p class="criteria-text" id="projectCriteria">-</p>
                                        </div>

                                        <!-- Notes Section -->
                                        <div class="project-notes-section" id="projectNotesSection"
                                            style="display: none;">
                                            <h4>üí° Ghi ch√∫</h4>
                                            <p class="notes-text" id="projectNotes">-</p>
                                        </div>

                                        <!-- Quota Section -->
                                        <div class="project-quota-section">
                                            <div class="quota-header">
                                                <h4>üìä Quota Status</h4>
                                                <button class="btn btn-xs btn-primary" onclick="refreshProjectQuotas()"
                                                    id="refreshQuotaBtn">
                                                    üîÑ Refresh
                                                </button>
                                            </div>
                                            <div class="quota-last-fetch" id="quotaLastFetch">Ch∆∞a fetch</div>
                                            <div class="quota-list" id="projectQuotaList">
                                                <div class="empty-state small">
                                                    <p>Click "Refresh" ƒë·ªÉ l·∫•y quota t·ª´ Alchemer</p>
                                                </div>
                                            </div>
                                            <div class="quota-summary" id="quotaSummary" style="display: none;">
                                                <div class="summary-item">
                                                    <span class="summary-label">T·ªïng ho√†n th√†nh:</span>
                                                    <span class="summary-value" id="quotaTotalCompleted">0</span>
                                                </div>
                                                <div class="summary-item">
                                                    <span class="summary-label">C√≤n thi·∫øu:</span>
                                                    <span class="summary-value highlight"
                                                        id="quotaTotalRemaining">0</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Data Info Section -->
                                        <div class="project-data-section">
                                            <div class="data-header">
                                                <h4>üìÇ Project Data</h4>
                                            </div>
                                            <div class="data-info" id="projectDataInfo">
                                                <p class="no-data-text">Ch∆∞a c√≥ data. Click "Import Data" ƒë·ªÉ th√™m.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <button class="btn btn-primary" onclick="importDataForProject()">
                                            üì• Import Data
                                        </button>
                                        <button class="btn btn-secondary" onclick="setAsActiveProject()">
                                            ‚≠ê Set as Active
                                        </button>
                                        <input type="file" id="projectFileInput" accept=".csv,.xlsx,.xls"
                                            style="display: none;" onchange="handleProjectFileImport(event)">
                                    </div>
                                </div>

                                <!-- No Project Selected -->
                                <div class="card" id="noProjectSelected">
                                    <div class="card-body">
                                        <div class="empty-state">
                                            <span class="empty-icon">üëà</span>
                                            <p>Ch·ªçn m·ªôt project t·ª´ danh s√°ch ƒë·ªÉ xem chi ti·∫øt</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Data View (Filter & Batch) -->
                <section class="view" id="dataView">
                    <div class="data-view-layout">
                        <div class="data-view-main">
                            <!-- Project Info Panel (Moved here) -->
                            <div id="projectInfoPanelContainer"></div>

                            <!-- Main content area -->
                            <div class="data-toolbar">
                                <div class="toolbar-left">
                                    <div class="filter-section">
                                        <button class="btn btn-icon" id="filterToggle" title="Toggle Filters">
                                            üîç
                                        </button>
                                        <span class="filter-status" id="filterStatus">No filter</span>
                                    </div>
                                    <div class="search-box">
                                        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm..."
                                            class="form-control">
                                    </div>
                                    <button class="btn btn-sm btn-secondary" onclick="shuffleData()"
                                        title="Shuffle Rows">
                                        <img src="assets/icons/cat.png" alt="" class="btn-icon-img"> üîÄ Shuffle
                                    </button>
                                    <div class="column-visibility-dropdown">
                                        <button class="btn btn-sm btn-outline" id="columnVisibilityBtn"
                                            title="Column Visibility">
                                            üëÅÔ∏è Columns
                                        </button>
                                        <div class="column-visibility-panel" id="columnVisibilityPanel"
                                            style="display: none;">
                                            <div class="panel-header">
                                                <span>Hi·ªÉn th·ªã c·ªôt</span>
                                                <button class="btn btn-xs btn-outline"
                                                    onclick="toggleAllColumns(true)">All</button>
                                                <button class="btn btn-xs btn-outline"
                                                    onclick="toggleAllColumns(false)">None</button>
                                            </div>
                                            <div class="column-list" id="columnVisibilityList"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <span class="row-count">Showing <span id="visibleCount">0</span> / <span
                                            id="totalCount">0</span></span>
                                    <button class="btn btn-icon" onclick="refreshData()" title="Refresh">üîÑ</button>
                                </div>
                            </div>

                            <div class="filter-panel" id="filterPanel" style="display: none;">
                                <div class="filter-builder">
                                    <div class="filter-conditions" id="filterConditions">
                                        <!-- Filter conditions will be added here -->
                                    </div>
                                    <div class="filter-actions">
                                        <button class="btn btn-sm btn-secondary" onclick="addFilterCondition()">+ Add
                                            Condition</button>
                                        <button class="btn btn-sm btn-primary" onclick="applyFilters()">Apply</button>
                                        <button class="btn btn-sm btn-outline" onclick="clearFilters()">Clear
                                            All</button>
                                    </div>
                                </div>
                                <div class="filter-presets">
                                    <label>Preset:</label>
                                    <select id="filterPreset" class="form-control form-control-sm">
                                        <option value="">-- Select --</option>
                                        <option value="unmarked">Ch∆∞a ƒë√°nh batch</option>
                                        <option value="sms-pending">SMS ch∆∞a g·ª≠i</option>
                                        <option value="email-pending">Email ch∆∞a g·ª≠i</option>
                                    </select>
                                    <button class="btn btn-sm btn-outline" onclick="saveFilterPreset()">Save</button>
                                </div>
                            </div>

                            <div class="data-table-container">
                                <table class="data-table" id="dataTable">
                                    <thead id="dataTableHead"></thead>
                                    <tbody id="dataTableBody"></tbody>
                                </table>
                                <div class="empty-state" id="dataEmptyState">
                                    <img src="assets/icons/mantis.png" alt="" class="empty-icon-img">
                                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng import file.</p>
                                    <button class="btn btn-primary" onclick="switchView('import')">Import Data</button>
                                </div>
                            </div>

                            <!-- Pagination -->
                            <div class="pagination-controls" id="paginationControls">
                                <div class="pagination-info">
                                    <span>Rows per page:</span>
                                    <select id="rowsPerPage" class="form-control form-control-sm"
                                        onchange="changeRowsPerPage(this.value)">
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="200">200</option>
                                        <option value="500">500</option>
                                    </select>
                                    <span class="page-info" id="pageInfo">Page 1 of 1</span>
                                </div>
                                <div class="pagination-buttons">
                                    <button class="btn btn-sm btn-outline" onclick="goToPage('first')" id="pageFirst">‚èÆÔ∏è
                                        First</button>
                                    <button class="btn btn-sm btn-outline" onclick="goToPage('prev')" id="pagePrev">‚óÄÔ∏è
                                        Prev</button>
                                    <span class="page-numbers" id="pageNumbers"></span>
                                    <button class="btn btn-sm btn-outline" onclick="goToPage('next')" id="pageNext">Next
                                        ‚ñ∂Ô∏è</button>
                                    <button class="btn btn-sm btn-outline" onclick="goToPage('last')" id="pageLast">Last
                                        ‚è≠Ô∏è</button>
                                </div>
                            </div>

                            <div class="data-actions">
                                <div class="batch-actions">
                                    <div class="action-group">
                                        <label>SMS Batch:</label>
                                        <div class="btn-group">
                                            <button class="btn btn-sms" onclick="markBatch('sms', 500)">Mark
                                                500</button>
                                            <button class="btn btn-sms" onclick="markBatch('sms', 1000)">Mark
                                                1000</button>
                                            <button class="btn btn-sms"
                                                onclick="markBatchPrompt('sms')">Custom...</button>
                                        </div>
                                    </div>
                                    <div class="action-group">
                                        <label>Email Batch:</label>
                                        <div class="btn-group">
                                            <button class="btn btn-email" onclick="markBatch('email', 500)">Mark
                                                500</button>
                                            <button class="btn btn-email" onclick="markBatch('email', 1000)">Mark
                                                1000</button>
                                            <button class="btn btn-email"
                                                onclick="markBatchPrompt('email')">Custom...</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-group">
                                    <label>Remind SMS:</label>
                                    <div class="btn-group">
                                        <button class="btn btn-sms" onclick="markBatch('remind_sms', 500)">Mark
                                            500</button>
                                        <button class="btn btn-sms" onclick="markBatch('remind_sms', 1000)">Mark
                                            1000</button>
                                        <button class="btn btn-sms"
                                            onclick="markBatchPrompt('remind_sms')">Custom...</button>
                                    </div>
                                </div>
                                <div class="action-group">
                                    <label>Remind Email:</label>
                                    <div class="btn-group">
                                        <button class="btn btn-email" onclick="markBatch('remind_email', 500)">Mark
                                            500</button>
                                        <button class="btn btn-email" onclick="markBatch('remind_email', 1000)">Mark
                                            1000</button>
                                        <button class="btn btn-email"
                                            onclick="markBatchPrompt('remind_email')">Custom...</button>
                                    </div>
                                </div>
                                <div class="action-group delete-batch-group">
                                    <label>üóëÔ∏è Delete Batch:</label>
                                    <div class="btn-group">
                                        <select id="deleteBatchType" class="form-control form-control-sm">
                                            <option value="sms">SMS</option>
                                            <option value="email">Email</option>
                                        </select>
                                        <select id="deleteBatchNumber" class="form-control form-control-sm">
                                            <option value="">-- Select --</option>
                                        </select>
                                        <button class="btn btn-danger btn-sm"
                                            onclick="deleteBatchAction()">Delete</button>
                                    </div>
                                </div>
                            </div>
                            <div class="undo-actions">
                                <button class="btn btn-outline" id="undoBtn" onclick="undoAction()" disabled>
                                    ‚Ü∂ Undo
                                </button>
                                <button class="btn btn-outline" id="redoBtn" onclick="redoAction()" disabled>
                                    Redo ‚Ü∑
                                </button>
                            </div>
                        </div>

                    </div> <!-- End data-view-main -->
            </div> <!-- End data-view-layout -->
            </section>

            <!-- Export View -->
            <section class="view" id="exportView">
                <div class="export-container">
                    <div class="card">
                        <div class="card-header">
                            <h3>üì§ Export Options</h3>
                        </div>
                        <div class="card-body">
                            <div class="export-type-tabs">
                                <button class="tab-btn active" data-type="sms">SMS Export</button>
                                <button class="tab-btn" data-type="email">Email Export</button>
                                <button class="tab-btn" data-type="custom">Custom Export</button>
                            </div>

                            <div class="export-panel" id="smsExportPanel">
                                <div class="form-group">
                                    <label>Select Batch:</label>
                                    <select id="smsBatchSelect" class="form-control">
                                        <option value="">-- Select batch --</option>
                                    </select>
                                </div>
                                <div class="export-preview-info">
                                    <span>Rows to export: <strong id="smsExportCount">0</strong></span>
                                </div>
                                <div class="form-group">
                                    <label>Columns to export:</label>
                                    <div class="column-chips" id="smsExportColumns">
                                        <span class="chip active">Phone (Column A)</span>
                                        <span class="chip active">SMS Content</span>
                                    </div>
                                </div>
                            </div>

                            <div class="export-panel" id="emailExportPanel" style="display: none;">
                                <div class="form-group">
                                    <label>Select Batch:</label>
                                    <select id="emailBatchSelect" class="form-control">
                                        <option value="">-- Select batch --</option>
                                    </select>
                                </div>
                                <div class="export-preview-info">
                                    <span>Rows to export: <strong id="emailExportCount">0</strong></span>
                                </div>
                                <div class="form-group">
                                    <label>Columns to export:</label>
                                    <div class="column-chips" id="emailExportColumns">
                                        <span class="chip active">Email</span>
                                        <span class="chip active">SGUID Link</span>
                                    </div>
                                </div>
                            </div>

                            <div class="export-panel" id="customExportPanel" style="display: none;">
                                <div class="form-group">
                                    <label>Select Columns:</label>
                                    <div class="column-selector" id="customColumnSelector">
                                        <!-- Dynamic columns -->
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Filter:</label>
                                    <select id="customExportFilter" class="form-control">
                                        <option value="all">All rows</option>
                                        <option value="visible">Visible rows only (current filter)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="form-group inline">
                                <label>Format:</label>
                                <select id="exportFormat" class="form-control form-control-sm">
                                    <option value="xlsx">Excel (.xlsx)</option>
                                    <option value="csv">CSV (.csv)</option>
                                </select>
                            </div>
                            <button class="btn btn-primary btn-lg" onclick="executeExport()">
                                üì• Download Export
                            </button>
                        </div>
                    </div>

                    <div class="card export-history-card">
                        <div class="card-header">
                            <h3>üìú Export History</h3>
                        </div>
                        <div class="card-body">
                            <ul class="export-history-list" id="exportHistory">
                                <li class="empty-state">
                                    <span class="empty-icon">üìÅ</span>
                                    <p>Ch∆∞a c√≥ export n√†o</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Config View -->
            <section class="view" id="configView">
                <div class="config-container">
                    <div class="card">
                        <div class="card-header">
                            <h3>‚öôÔ∏è Column Configuration</h3>
                        </div>
                        <div class="card-body">
                            <div class="config-grid">
                                <div class="form-group">
                                    <label>Source Column (sguid_link):</label>
                                    <select id="configSourceCol" class="form-control">
                                        <option value="E">E</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Content Column (SMS):</label>
                                    <select id="configContentCol" class="form-control">
                                        <option value="P">P</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>SMS Batch Column:</label>
                                    <select id="configBatchCol" class="form-control">
                                        <option value="Q">Q</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Email Column:</label>
                                    <select id="configEmailCol" class="form-control">
                                        <option value="H">H</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Email Batch Column:</label>
                                    <select id="configEmailBatchCol" class="form-control">
                                        <option value="S">S</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Email Link Column:</label>
                                    <select id="configEmailLinkCol" class="form-control">
                                        <option value="E">E</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Remind SMS Batch Column:</label>
                                    <select id="configRemindSmsBatchCol" class="form-control">
                                        <option value="T">T</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Remind Email Batch Column:</label>
                                    <select id="configRemindEmailBatchCol" class="form-control">
                                        <option value="U">U</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Respondent Status Column:</label>
                                    <select id="configStatusCol" class="form-control">
                                        <option value="V">V</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- API Credentials Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üîë Alchemer API Credentials</h3>
                            <span class="api-status" id="alchemerApiStatus">Not configured</span>
                        </div>
                        <div class="card-body">
                            <p class="form-hint" style="margin-bottom: 16px;">
                                ƒê·ªÉ fetch quota t·ª´ Alchemer, b·∫°n c·∫ßn nh·∫≠p API credentials.
                                L·∫•y t·ª´: Alchemer ‚Üí Account ‚Üí Integrations ‚Üí API
                            </p>
                            <div class="form-group">
                                <label>API Token:</label>
                                <input type="text" id="alchemerApiToken" class="form-control"
                                    placeholder="Nh·∫≠p API Token">
                            </div>
                            <div class="form-group">
                                <label>API Token Secret:</label>
                                <input type="password" id="alchemerApiSecret" class="form-control"
                                    placeholder="Nh·∫≠p API Token Secret">
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="saveAlchemerCredentials()">
                                üíæ Save Credentials
                            </button>
                            <button class="btn btn-outline" onclick="testAlchemerConnection()">
                                üîó Test Connection
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>üìù Template Management</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Current Template:</label>
                                <textarea id="templateText" class="form-control" rows="4"
                                    placeholder="Enter SMS template text..."></textarea>
                                <small class="form-hint">Bi·∫øn {link} s·∫Ω ƒë∆∞·ª£c thay b·∫±ng gi√° tr·ªã t·ª´ Source
                                    Column</small>
                            </div>
                            <div class="template-library">
                                <label>Saved Templates:</label>
                                <div class="template-list" id="templateList">
                                    <!-- Dynamic content populated by UIRenderer.renderTemplateLibrary() -->
                                </div>
                                <button class="btn btn-secondary" onclick="saveCurrentTemplate()">+ Save Current as
                                    Template</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>üîß Advanced Options</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="configOverwriteBatch">
                                    Overwrite existing batch (ghi ƒë√® batch c≈©)
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="configExportAfterMark">
                                    Auto export after mark
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Default batch limit:</label>
                                <input type="number" id="configDefaultLimit" class="form-control" value="500" min="1">
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-secondary" onclick="resetConfig()">Reset to Defaults</button>
                            <button class="btn btn-primary" onclick="saveConfig()">Save Configuration</button>
                        </div>
                    </div>
                </div>
            </section>
    </div>
    </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/configManager.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/filterEngine.js"></script>
    <script src="js/batchManager.js"></script>
    <script src="js/exportManager.js"></script>
    <script src="js/alchemerApi.js"></script>
    <script src="js/projectManager.js"></script>
    <script src="js/uiRenderer.js"></script>
    <script src="js/storageManager.js"></script>
    <script src="index.js"></script>
</body>

</html>